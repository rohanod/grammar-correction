================================================================================
           GRAMMAR CORRECTION VIEWER - URL CREATION GUIDE
================================================================================

OVERVIEW
--------
This application displays grammar corrections by highlighting changes between
original and corrected text. It accepts data via a single URL parameter.


URL STRUCTURE
-------------
https://your-app.github.app/?data=<BASE64_ENCODED_DATA>

Single required URL parameter:
  data - Base64-encoded JSON containing all correction information


SIMPLIFIED FORMAT
-----------------
The new format uses a single "data" parameter containing everything:
- Original text
- Corrected text  
- All correction details

This makes URLs cleaner and easier to generate programmatically.


DATA STRUCTURE
--------------
The JSON object before encoding should contain:

{
  "original": "Text with errors",
  "corrected": "Text with corrections applied",
  "corrections": [
    {
      "type": "correction-type",
      "original": "wrong",
      "corrected": "right",
      "position": 0,
      "reason": "Why this was corrected"
    }
  ]
}

Correction Types:
- "grammar" - Grammar error (subject-verb agreement, tense, etc.)
- "spelling" - Spelling mistake
- "punctuation" - Punctuation change
- "word-choice" - Better word choice
- "capitalization" - Capitalization error


CORRECTION OBJECT FIELDS
-------------------------
type       (required) - Type of correction
original   (required) - The original incorrect text
corrected  (required) - The corrected text
position   (required) - Character position in original text
reason     (optional) - Explanation of the correction


STEP-BY-STEP: CREATING A URL
-----------------------------

Step 1: Create your data object
const data = {
  original: "helo world! This are wrong",
  corrected: "Hello world! This is wrong",
  corrections: [
    {
      type: "spelling",
      original: "helo",
      corrected: "Hello",
      position: 0,
      reason: "Spelling error"
    },
    {
      type: "grammar",
      original: "are",
      corrected: "is",
      position: 18,
      reason: "Subject-verb agreement"
    }
  ]
}

Step 2: Convert to JSON string
const jsonString = JSON.stringify(data)

Step 3: Base64 encode
const encoded = btoa(encodeURIComponent(jsonString).replace(
  /%([0-9A-F]{2})/g,
  (_, p1) => String.fromCharCode(parseInt(p1, 16))
))

Step 4: Create URL
const url = `https://your-app.github.app/?data=${encoded}`


JAVASCRIPT EXAMPLE (COMPLETE)
------------------------------

function generateCorrectionURL(data) {
  // Base64 encode with proper UTF-8 support
  const jsonString = JSON.stringify(data)
  const encoded = btoa(
    encodeURIComponent(jsonString).replace(
      /%([0-9A-F]{2})/g,
      (_, p1) => String.fromCharCode(parseInt(p1, 16))
    )
  )
  return `https://your-app.github.app/?data=${encoded}`
}

// Usage
const correctionData = {
  original: "helo world! This are a example",
  corrected: "Hello world! This is an example",
  corrections: [
    {
      type: "spelling",
      original: "helo",
      corrected: "Hello",
      position: 0,
      reason: "Spelling error"
    },
    {
      type: "grammar",
      original: "are",
      corrected: "is",
      position: 18,
      reason: "Subject-verb agreement"
    },
    {
      type: "grammar",
      original: "a",
      corrected: "an",
      position: 21,
      reason: "Article correction"
    }
  ]
}

const url = generateCorrectionURL(correctionData)
console.log(url)


PYTHON EXAMPLE (COMPLETE)
--------------------------

import json
import base64
from urllib.parse import quote

def generate_correction_url(data):
    """Generate a correction URL from data object"""
    json_string = json.dumps(data)
    encoded = base64.b64encode(json_string.encode('utf-8')).decode('ascii')
    return f"https://your-app.github.app/?data={encoded}"

# Usage
correction_data = {
    "original": "helo world! This are a example",
    "corrected": "Hello world! This is an example",
    "corrections": [
        {
            "type": "spelling",
            "original": "helo",
            "corrected": "Hello",
            "position": 0,
            "reason": "Spelling error"
        },
        {
            "type": "grammar",
            "original": "are",
            "corrected": "is",
            "position": 18,
            "reason": "Subject-verb agreement"
        },
        {
            "type": "grammar",
            "original": "a",
            "corrected": "an",
            "position": 21,
            "reason": "Article correction"
        }
    ]
}

url = generate_correction_url(correction_data)
print(url)


FINDING CHARACTER POSITIONS
----------------------------
The "position" field indicates where in the ORIGINAL text the error starts.

Example: "helo world! This are wrong"
         0123456789...

"helo" starts at position 0
"are" starts at position 18

JavaScript:
  const position = originalText.indexOf("error word")

Python:
  position = original_text.find("error word")


BACKWARDS COMPATIBILITY
-----------------------
The old format is still supported for existing URLs:
?original=<text>&corrections=<json>

However, new URLs should use the simplified format:
?data=<base64>


ADVANTAGES OF NEW FORMAT
-------------------------
✓ Cleaner URLs - single parameter instead of two
✓ Easier to generate - one encoding step
✓ More compact - base64 is shorter than double URL encoding
✓ Better for sharing - less likely to break in messaging apps
✓ Simpler to document - one parameter to explain


COMMON MISTAKES TO AVOID
-------------------------
1. Forgetting to stringify JSON before encoding
   ✗ btoa(dataObject)
   ✓ btoa(JSON.stringify(dataObject))

2. Not handling UTF-8 characters properly
   - Use the provided encoding function for special characters

3. Wrong character positions
   - Count from 0, not 1
   - Include spaces in your count
   - Positions are in the ORIGINAL text

4. Mismatched corrections
   - Original field must match text in original string
   - Corrected field should be the replacement

5. Invalid JSON structure
   - Must have "original", "corrected", and "corrections" fields
   - Corrections must be an array


TESTING YOUR URL
----------------
1. Use the "Try Example" button in the app to see the format
2. Start with simple corrections
3. Validate your JSON structure
4. Test the generated URL in a browser
5. Use console.log to debug encoding issues


URL LENGTH CONSIDERATIONS
--------------------------
- Base64 encoding increases size by ~33%
- Browser URL limits: typically 2000-8000 characters
- For very long texts, consider backend storage
- Special characters increase encoded size


TROUBLESHOOTING
---------------
Problem: Page shows empty state
→ Verify "data" parameter exists and is properly encoded

Problem: No highlights showing  
→ Check correction positions match original text

Problem: Decoding errors
→ Ensure proper base64 encoding with UTF-8 support

Problem: Corrections not displaying
→ Validate JSON structure has all required fields


MIGRATING FROM OLD FORMAT
--------------------------
Old format:
  ?original=text&corrections={"corrected":"...","corrections":[...]}

New format:
  ?data=eyJvcmlnaW5hbCI6InRleHQiLCJjb3JyZWN0ZWQiOiIuLi4iLC4uLn0=

Use the generateCorrectionURL() function to convert:
  const url = generateCorrectionURL({
    original: oldOriginal,
    corrected: oldData.corrected,
    corrections: oldData.corrections
  })


================================================================================
